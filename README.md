# Winter Sauna Bot üßñ‚Äç‚ôÄÔ∏è (PHP –≤–µ—Ä—Å–∏—è)

–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π Telegram –±–æ—Ç –¥–ª—è –±–∞–Ω–∏ "–ó–∏–º–∞" –Ω–∞ –ü—Ö—É–∫–µ—Ç–µ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –ò–ò –¥–ª—è –ø–æ–º–æ—â–∏ –∫–ª–∏–µ–Ω—Ç–∞–º —Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è–º–∏.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–£–º–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI GPT-4 –¥–ª—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è
- **–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–º–æ—â—å –≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ —É—Å–ª—É–≥ –±–∞–Ω–∏
- **–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏**: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Ö –∏ —É—Å–ª—É–≥–∞—Ö
- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- **Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Telegram Bot API

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- PHP 7.4+ 
- cURL —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
- JSON —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
- –ê–∫–∫–∞—É–Ω—Ç –≤ Lark Open Platform
- OpenAI API –∫–ª—é—á
- ngrok –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
```bash
git clone https://gitlab.com/a.novikov6/staff-helper.git
cd staff-helper
```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
```bash
cp env.php .env
```

3. **–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª** —Å –≤–∞—à–∏–º–∏ API –∫–ª—é—á–∞–º–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
php start-server.php
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.env`:

```env
# Lark Bot Configuration
LARK_APP_ID=your_app_id_here
LARK_APP_SECRET=your_app_secret_here
LARK_WEBHOOK_URL=http://localhost:8000/webhook.php

# OpenAI Configuration
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_MODEL=gpt-4

# Security
WEBHOOK_VERIFICATION_TOKEN=your_verification_token_here
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Lark Bot

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Lark

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Lark Open Platform](https://open.feishu.cn/)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –í —Ä–∞–∑–¥–µ–ª–µ "Credentials" —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ `App ID` –∏ `App Secret`

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Event Subscriptions

1. –í —Ä–∞–∑–¥–µ–ª–µ "Event Subscriptions" –≤–∫–ª—é—á–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ —Å–æ–±—ã—Ç–∏—è
2. –î–æ–±–∞–≤—å—Ç–µ URL –≤–∞—à–µ–≥–æ webhook: `https://your-ngrok-url.ngrok.io/webhook.php`
3. –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ —Å–æ–±—ã—Ç–∏—è:
   - `im.message.receive_v1` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
   - `im.message.message_read_v1` - –ø—Ä–æ—á—Ç–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Permissions

–í —Ä–∞–∑–¥–µ–ª–µ "Permissions" –¥–æ–±–∞–≤—å—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞:
- `im:message` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- `im:message:read` - —á—Ç–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- `im:chat` - –¥–æ—Å—Ç—É–ø –∫ —á–∞—Ç–∞–º
- `contact:user.id:read` - —á—Ç–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö

### 4. –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

1. –í —Ä–∞–∑–¥–µ–ª–µ "Version Management" —Å–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ä—Å–∏—é
2. –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –ø—É–±–ª–∏–∫–∞—Ü–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. –ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –¥–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –Ω—É–∂–Ω—ã–µ —á–∞—Ç—ã

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ index.php                # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ webhook.php              # Webhook endpoint
‚îú‚îÄ‚îÄ health.php               # Health check
‚îú‚îÄ‚îÄ start-server.php         # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ test-webhook.php         # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ config.php           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ WebhookHandler.php   # –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ LarkService.php      # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Lark API
‚îÇ   ‚îî‚îÄ‚îÄ AIService.php        # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI
‚îî‚îÄ‚îÄ env.php                  # –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

## üîå API Endpoints

### `POST /webhook.php`
–û—Å–Ω–æ–≤–Ω–æ–π endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –æ—Ç Lark.

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–æ–±—ã—Ç–∏—è:**
- `url_verification` - –ø—Ä–æ–≤–µ—Ä–∫–∞ URL
- `im.message.receive_v1` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

### `GET /health.php`
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞.

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook
php test-webhook.php

# –ü—Ä–æ–≤–µ—Ä–∫–∞ health check
curl http://localhost:8000/health.php
```

## ü§ñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞

### –í –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —á–∞—Ç–µ
–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.

### –í –≥—Ä—É–ø–ø–æ–≤–æ–º —á–∞—Ç–µ
–£–ø–æ–º—è–Ω–∏—Ç–µ –±–æ—Ç–∞ (@–±–æ—Ç) –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:
- "–ø–æ–º–æ—â—å", "–ø–æ–º–æ–≥–∏"
- "–∑–∞–¥–∞—á–∞", "–ø–ª–∞–Ω"
- "–Ω–∞–ø–æ–º–Ω–∏"

### –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥

```
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ü–æ–º–æ–≥–∏ —Å–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –¥–µ–Ω—å
ü§ñ –ë–æ—Ç: üìã –û—Ç–ª–∏—á–Ω–æ! –î–∞–≤–∞–π—Ç–µ —Å–æ—Å—Ç–∞–≤–∏–º –ø–ª–∞–Ω –Ω–∞ –¥–µ–Ω—å. 
        –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, –∫–∞–∫–∏–µ —É –≤–∞—Å –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã?

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ù–∞–ø–æ–º–Ω–∏ –º–Ω–µ –ø—Ä–æ –≤—Å—Ç—Ä–µ—á—É –≤ 15:00
ü§ñ –ë–æ—Ç: ‚è∞ –ö–æ–Ω–µ—á–Ω–æ! –Ø –Ω–∞–ø–æ–º–Ω—é –≤–∞–º –ø—Ä–æ –≤—Å—Ç—Ä–µ—á—É –≤ 15:00. 
        –ß—Ç–æ —ç—Ç–æ –∑–∞ –≤—Å—Ç—Ä–µ—á–∞ –∏ —Å –∫–µ–º?

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –°–æ–∑–¥–∞–π —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫
ü§ñ –ë–æ—Ç: üìã –°–æ–∑–¥–∞—é —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫! –ù–∞–ø–∏—à–∏—Ç–µ, —á—Ç–æ –Ω—É–∂–Ω–æ –∫—É–ø–∏—Ç—å, 
        –∏ —è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É—é —Å–ø–∏—Å–æ–∫ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞.
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ PHP: `tail -f /var/log/php_errors.log`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ webhook URL –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ ngrok
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Lark

### –û—à–∏–±–∫–∏ API
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å App ID –∏ Secret –≤ .env
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –µ—Å—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã OpenAI API

### –ü—Ä–æ–±–ª–µ–º—ã —Å ngrok
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ ngrok –∑–∞–ø—É—â–µ–Ω: `ngrok http 8000`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ URL –≤ Lark —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç ngrok URL
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ webhook URL –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ `/webhook.php`

---

**–£–¥–∞—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è! üöÄ**